{% extends "base.html" %}

{% block title %}–î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-6xl mx-auto">
        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
        <div class="flex items-center justify-between mb-8">
            <div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">üìö –î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫</h1>
                <p class="text-gray-600">–°–æ–∑–¥–∞–π—Ç–µ —É—Ä–æ–∫ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏–ª–∏ –≤—Ä—É—á–Ω—É—é</p>
            </div>
            <a href="{% url 'home' %}" class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-2 px-4 rounded">
                ‚Üê –ù–∞–∑–∞–¥
            </a>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º–∞ -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <form method="post" class="space-y-6" id="lessonForm">
                        {% csrf_token %}

                        <!-- –í—ã–±–æ—Ä —Ç–∏–ø–∞ —É—Ä–æ–∫–∞ -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">
                                –°–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è —É—Ä–æ–∫–∞ <span class="text-red-500">*</span>
                            </label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <label class="relative flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition duration-200" id="fromScheduleOption">
                                    <input type="radio" name="lesson_type" value="from_schedule" class="sr-only" onchange="toggleLessonType()">
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center">
                                            <div class="w-2 h-2 bg-blue-600 rounded-full hidden"></div>
                                        </div>
                                        <div>
                                            <h4 class="font-medium text-gray-900">üìÖ –ò–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</h4>
                                            <p class="text-sm text-gray-500">–ë—ã—Å—Ç—Ä–æ, –≤—Ä–µ–º—è –ø–æ–¥—Å—Ç–∞–≤–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                                        </div>
                                    </div>
                                </label>

                                <label class="relative flex items-center p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition duration-200" id="manualOption">
                                    <input type="radio" name="lesson_type" value="manual" class="sr-only" onchange="toggleLessonType()">
                                    <div class="flex items-center">
                                        <div class="w-4 h-4 border-2 border-gray-300 rounded-full mr-3 flex items-center justify-center">
                                            <div class="w-2 h-2 bg-blue-600 rounded-full hidden"></div>
                                        </div>
                                        <div>
                                            <h4 class="font-medium text-gray-900">‚úèÔ∏è –í—Ä—É—á–Ω—É—é</h4>
                                            <p class="text-sm text-gray-500">–ü–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å, –º–æ–∂–Ω–æ –±–µ–∑ –≤—Ä–µ–º–µ–Ω–∏</p>
                                        </div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- –î–∞—Ç–∞ —É—Ä–æ–∫–∞ -->
                        <div>
                            <label for="date" class="block text-sm font-medium text-gray-700 mb-2">
                                –î–∞—Ç–∞ —É—Ä–æ–∫–∞ <span class="text-red-500">*</span>
                            </label>
                            <input type="date" name="date" id="date" required
                                   min="{{ today|date:'Y-m-d' }}"
                                   onchange="updateAvailableSchedules()"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        </div>

                        <!-- –ë–õ–û–ö 1: –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è -->
                        <div id="scheduleBlock" class="hidden">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <h4 class="font-medium text-blue-800 mb-2">üìÖ –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–Ω—è—Ç–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</h4>
                                <p class="text-sm text-blue-700">–í—Ä–µ–º—è –∏ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –ø–æ–¥—Å—Ç–∞–≤–ª–µ–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏</p>
                            </div>

                            <div id="availableSchedules" class="space-y-3">
                                <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è -->
                                <p class="text-gray-500 text-center py-4">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è</p>
                            </div>

                            <div class="mt-4">
                                <label for="classroom_schedule" class="block text-sm font-medium text-gray-700 mb-2">
                                    –ê—É–¥–∏—Ç–æ—Ä–∏—è (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å)
                                </label>
                                <input type="text" name="classroom" id="classroom_schedule"
                                       placeholder="–û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>

                        <!-- –ë–õ–û–ö 2: –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ -->
                        <div id="manualBlock" class="hidden space-y-4">
                            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-4">
                                <h4 class="font-medium text-yellow-800 mb-2">‚úèÔ∏è –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —É—Ä–æ–∫–∞</h4>
                                <p class="text-sm text-yellow-700">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤—Ä—É—á–Ω—É—é. –í—Ä–µ–º—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.</p>
                            </div>

                            <!-- –ü—Ä–µ–¥–º–µ—Ç -->
                            <div>
                                <label for="subject" class="block text-sm font-medium text-gray-700 mb-2">
                                    –ü—Ä–µ–¥–º–µ—Ç <span class="text-red-500">*</span>
                                </label>
                                <select name="subject" id="subject"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç</option>
                                    {% for subject in subjects %}
                                    <option value="{{ subject.id }}">{{ subject.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- –ì—Ä—É–ø–ø–∞ -->
                            <div>
                                <label for="group" class="block text-sm font-medium text-gray-700 mb-2">
                                    –ì—Ä—É–ø–ø–∞ <span class="text-red-500">*</span>
                                </label>
                                <select name="group" id="group"
                                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –≥—Ä—É–ø–ø—É</option>
                                    {% for group in groups %}
                                    <option value="{{ group.id }}">{{ group.name }} (–ö—É—Ä—Å {{ group.course }})</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <!-- –í—Ä–µ–º—è (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ) -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label for="start_time" class="block text-sm font-medium text-gray-700 mb-2">
                                        –í—Ä–µ–º—è –Ω–∞—á–∞–ª–∞
                                    </label>
                                    <input type="time" name="start_time" id="start_time"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div>
                                    <label for="end_time" class="block text-sm font-medium text-gray-700 mb-2">
                                        –í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è
                                    </label>
                                    <input type="time" name="end_time" id="end_time"
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                            </div>

                            <!-- –ê—É–¥–∏—Ç–æ—Ä–∏—è -->
                            <div>
                                <label for="classroom_manual" class="block text-sm font-medium text-gray-700 mb-2">
                                    –ê—É–¥–∏—Ç–æ—Ä–∏—è
                                </label>
                                <input type="text" name="classroom" id="classroom_manual"
                                       placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 101, –ê–∫—Ç–æ–≤—ã–π –∑–∞–ª"
                                       class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                            </div>
                        </div>

                        <!-- –ó–∞–º–µ—Ç–∫–∏ (–æ–±—â–µ–µ –ø–æ–ª–µ) -->
                        <div>
                            <label for="notes" class="block text-sm font-medium text-gray-700 mb-2">
                                –ó–∞–º–µ—Ç–∫–∏ –∫ —É—Ä–æ–∫—É
                            </label>
                            <textarea name="notes" id="notes" rows="3"
                                      placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —É—Ä–æ–∫–µ..."
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"></textarea>
                        </div>

                        <!-- –ö–Ω–æ–ø–∫–∏ -->
                        <div class="flex justify-end pt-4">
                            <button type="submit" id="submitBtn" disabled
                                    class="bg-blue-600 hover:bg-blue-700 disabled:bg-gray-400 text-white font-bold py-3 px-6 rounded-lg transition duration-200">
                                ‚úÖ –°–æ–∑–¥–∞—Ç—å —É—Ä–æ–∫
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å -->
            <div>
                <div class="bg-white rounded-lg shadow-lg p-6">
                    <h3 class="text-lg font-bold text-gray-800 mb-4">üìÖ –í–∞—à–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</h3>

                    {% if teacher_schedule %}
                        <div class="space-y-3 max-h-96 overflow-y-auto">
                            {% for schedule in teacher_schedule %}
                            <div class="p-3 bg-gray-50 rounded-lg border-l-4 border-blue-500"
                                 data-schedule-id="{{ schedule.id }}"
                                 data-weekday="{{ schedule.weekday }}"
                                 data-subject="{{ schedule.subject.name }}"
                                 data-group="{{ schedule.group.name }}"
                                 data-time="{{ schedule.get_time_range }}"
                                 data-classroom="{{ schedule.classroom|default:'' }}">
                                <div class="font-medium text-gray-900">{{ schedule.subject.name }}</div>
                                <div class="text-sm text-gray-600">{{ schedule.group.name }}</div>
                                <div class="text-sm text-gray-500">{{ schedule.get_weekday_display }} ‚Ä¢ {{ schedule.get_time_range }}</div>
                                {% if schedule.classroom %}
                                    <div class="text-xs text-gray-500">üè¢ {{ schedule.classroom }}</div>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center text-gray-500 py-8">
                            <svg class="mx-auto h-12 w-12 text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                            </svg>
                            <p class="text-sm">–£ –≤–∞—Å –Ω–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è</p>
                            <a href="{% url 'add_schedule' %}" class="text-blue-600 hover:text-blue-800 text-sm mt-2 inline-block">
                                –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                            </a>
                        </div>
                    {% endif %}
                </div>

                <!-- –ü–æ–¥—Å–∫–∞–∑–∫–∏ -->
                <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-medium text-blue-800 mb-2">üí° –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç</h4>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>‚Ä¢ <strong>–ò–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è:</strong> –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∏ –≥–æ—Ç–æ–≤–æ–µ –∑–∞–Ω—è—Ç–∏–µ</li>
                        <li>‚Ä¢ <strong>–í—Ä—É—á–Ω—É—é:</strong> —Å–æ–∑–¥–∞–π—Ç–µ —É—Ä–æ–∫ —Å –Ω—É–ª—è</li>
                        <li>‚Ä¢ –í—Ä–µ–º—è –º–æ–∂–Ω–æ –Ω–µ —É–∫–∞–∑—ã–≤–∞—Ç—å –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è</li>
                        <li>‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç—Å—è –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å –¥–ª—è –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// –î–∞–Ω–Ω—ã–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –¥–ª—è JS
const scheduleData = [
    {% for schedule in teacher_schedule %}
    {
        id: {{ schedule.id }},
        weekday: {{ schedule.weekday }},
        subject: "{{ schedule.subject.name }}",
        group: "{{ schedule.group.name }}",
        time: "{{ schedule.get_time_range }}",
        classroom: "{{ schedule.classroom|default:'' }}",
        weekday_name: "{{ schedule.get_weekday_display }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
];

console.log('üìÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π:', scheduleData.length);

function toggleLessonType() {
    const scheduleRadio = document.querySelector('input[value="from_schedule"]');
    const manualRadio = document.querySelector('input[value="manual"]');
    const scheduleBlock = document.getElementById('scheduleBlock');
    const manualBlock = document.getElementById('manualBlock');
    const submitBtn = document.getElementById('submitBtn');

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('input[name="lesson_type"]').forEach(radio => {
        const option = radio.closest('label');
        const circle = option.querySelector('.w-2');

        if (radio.checked) {
            option.classList.add('border-blue-500', 'bg-blue-50');
            option.classList.remove('border-gray-200');
            circle.classList.remove('hidden');
        } else {
            option.classList.remove('border-blue-500', 'bg-blue-50');
            option.classList.add('border-gray-200');
            circle.classList.add('hidden');
        }
    });

    if (scheduleRadio.checked) {
        console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è');
        scheduleBlock.classList.remove('hidden');
        manualBlock.classList.add('hidden');
        updateAvailableSchedules();

        // –î–µ–ª–∞–µ–º –ø–æ–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏
        document.getElementById('subject').removeAttribute('required');
        document.getElementById('group').removeAttribute('required');

        // –û—á–∏—â–∞–µ–º –ø–æ–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
        document.getElementById('classroom_manual').disabled = true;
        document.getElementById('classroom_schedule').disabled = false;

    } else if (manualRadio.checked) {
        console.log('üîÑ –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–æ –Ω–∞ —Ä—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ');
        scheduleBlock.classList.add('hidden');
        manualBlock.classList.remove('hidden');
        submitBtn.disabled = false;

        // –î–µ–ª–∞–µ–º –ø–æ–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏
        document.getElementById('subject').setAttribute('required', 'required');
        document.getElementById('group').setAttribute('required', 'required');

        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º –ø–æ–ª—è –∞—É–¥–∏—Ç–æ—Ä–∏–∏
        document.getElementById('classroom_schedule').disabled = true;
        document.getElementById('classroom_manual').disabled = false;
    }
}

function updateAvailableSchedules() {
    const dateInput = document.getElementById('date');
    const schedulesContainer = document.getElementById('availableSchedules');
    const submitBtn = document.getElementById('submitBtn');

    if (!dateInput.value) {
        schedulesContainer.innerHTML = '<p class="text-gray-500 text-center py-4">–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É</p>';
        submitBtn.disabled = true;
        return;
    }

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏
    const date = new Date(dateInput.value);
    const weekday = (date.getDay() + 6) % 7; // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –∏–∑ JS –≤ Python —Ñ–æ—Ä–º–∞—Ç

    console.log('üìÖ –í—ã–±—Ä–∞–Ω–Ω–∞—è –¥–∞—Ç–∞:', dateInput.value, '–î–µ–Ω—å –Ω–µ–¥–µ–ª–∏:', weekday);

    // –§–∏–ª—å—Ç—Ä—É–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –ø–æ –¥–Ω—é –Ω–µ–¥–µ–ª–∏
    const availableSchedules = scheduleData.filter(schedule => schedule.weekday === weekday);

    console.log('üìã –ù–∞–π–¥–µ–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –¥–ª—è —ç—Ç–æ–≥–æ –¥–Ω—è:', availableSchedules.length);

    if (availableSchedules.length === 0) {
        schedulesContainer.innerHTML = `
            <div class="text-center py-8 text-gray-500">
                <svg class="mx-auto h-12 w-12 text-gray-300 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <p class="text-sm">–ù–µ—Ç –∑–∞–Ω—è—Ç–∏–π –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –¥–µ–Ω—å</p>
                <p class="text-xs text-gray-400 mt-1">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å —É—Ä–æ–∫ –≤—Ä—É—á–Ω—É—é</p>
            </div>
        `;
        submitBtn.disabled = true;
        return;
    }

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∑–∞–Ω—è—Ç–∏—è
    let schedulesHTML = '<div class="space-y-3">';
    availableSchedules.forEach(schedule => {
        schedulesHTML += `
            <label class="block p-4 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-300 transition duration-200" data-schedule="${schedule.id}">
                <input type="radio" name="schedule_id" value="${schedule.id}" class="sr-only" onchange="selectSchedule(this)">
                <div class="flex justify-between items-start">
                    <div class="flex-1">
                        <h5 class="font-medium text-gray-900">${schedule.subject}</h5>
                        <p class="text-sm text-gray-600">${schedule.group}</p>
                        <p class="text-sm text-blue-600">${schedule.time}</p>
                        ${schedule.classroom ? `<p class="text-xs text-gray-500">üè¢ ${schedule.classroom}</p>` : ''}
                    </div>
                    <div class="w-4 h-4 border-2 border-gray-300 rounded-full flex items-center justify-center ml-3">
                        <div class="w-2 h-2 bg-blue-600 rounded-full hidden"></div>
                    </div>
                </div>
            </label>
        `;
    });
    schedulesHTML += '</div>';

    schedulesContainer.innerHTML = schedulesHTML;
    submitBtn.disabled = true; // –ñ–¥–µ–º –≤—ã–±–æ—Ä–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
}

function selectSchedule(radio) {
    const submitBtn = document.getElementById('submitBtn');

    console.log('‚úÖ –í—ã–±—Ä–∞–Ω–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ:', radio.value);

    // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
    document.querySelectorAll('input[name="schedule_id"]').forEach(r => {
        const label = r.closest('label');
        const circle = label.querySelector('.w-2');

        if (r.checked) {
            label.classList.add('border-blue-500', 'bg-blue-50');
            label.classList.remove('border-gray-200');
            circle.classList.remove('hidden');
        } else {
            label.classList.remove('border-blue-500', 'bg-blue-50');
            label.classList.add('border-gray-200');
            circle.classList.add('hidden');
        }
    });

    // –†–∞–∑—Ä–µ—à–∞–µ–º –æ—Ç–ø—Ä–∞–≤–∫—É —Ñ–æ—Ä–º—ã
    submitBtn.disabled = false;
}

// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º—ã
document.getElementById('lessonForm').addEventListener('submit', function(e) {
    const lessonType = document.querySelector('input[name="lesson_type"]:checked');
    const date = document.getElementById('date').value;

    console.log('üìù –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã. –¢–∏–ø:', lessonType?.value, '–î–∞—Ç–∞:', date);

    if (!lessonType) {
        e.preventDefault();
        alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± —Å–æ–∑–¥–∞–Ω–∏—è —É—Ä–æ–∫–∞');
        return false;
    }

    if (!date) {
        e.preventDefault();
        alert('–í—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É —É—Ä–æ–∫–∞');
        return false;
    }

    if (lessonType.value === 'from_schedule') {
        const scheduleId = document.querySelector('input[name="schedule_id"]:checked');
        if (!scheduleId) {
            e.preventDefault();
            alert('–í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–Ω—è—Ç–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è');
            return false;
        }
        console.log('‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, ID:', scheduleId.value);
    } else if (lessonType.value === 'manual') {
        const subject = document.getElementById('subject').value;
        const group = document.getElementById('group').value;

        if (!subject || !group) {
            e.preventDefault();
            alert('–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –∏ –≥—Ä—É–ø–ø—É');
            return false;
        }

        const startTime = document.getElementById('start_time').value;
        const endTime = document.getElementById('end_time').value;

        if (startTime && endTime && startTime >= endTime) {
            e.preventDefault();
            alert('–í—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –±–æ–ª—å—à–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞—á–∞–ª–∞');
            return false;
        }

        console.log('‚úÖ –†—É—á–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ. –ü—Ä–µ–¥–º–µ—Ç:', subject, '–ì—Ä—É–ø–ø–∞:', group);
    }

    console.log('üöÄ –§–æ—Ä–º–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
    return true;
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
document.addEventListener('DOMContentLoaded', function() {
    console.log('üîß –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ–æ—Ä–º—ã');

    const today = new Date().toISOString().split('T')[0];
    document.getElementById('date').value = today;

    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è
    document.getElementById('start_time').value = '09:00';
    document.getElementById('end_time').value = '10:30';

    // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–±–∏—Ä–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è
    document.querySelector('input[value="from_schedule"]').checked = true;
    toggleLessonType();

    console.log('‚úÖ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞');
});
</script>

<style>
.container {
    animation: fadeIn 0.5s ease-in;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–¥–∏–æ–∫–Ω–æ–ø–æ–∫ */
input[type="radio"]:checked + div .w-2 {
    display: block !important;
}

/* –ê–Ω–∏–º–∞—Ü–∏–∏ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ */
#scheduleBlock, #manualBlock {
    transition: all 0.3s ease;
}

/* –û—Ç–∫–ª—é—á–µ–Ω–Ω—ã–µ –ø–æ–ª—è */
input:disabled, select:disabled {
    background-color: #f3f4f6;
    color: #6b7280;
    cursor: not-allowed;
}
</style>
{% endblock %}

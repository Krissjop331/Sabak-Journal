<!DOCTYPE html>
<html lang="ru">
	<head>
		{% load static %}
    {% csrf_token %}
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</title>
		<link rel="stylesheet" href="{% static 'css/admin_custom.css' %}" />
		<link
			href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
			rel="stylesheet"
		/>
		<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<style>
			/* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ */
			.tab-link {
				position: relative;
				transition: all 0.3s ease;
			}

			.tab-link::after {
				content: '';
				position: absolute;
				bottom: -2px;
				left: 0;
				width: 0;
				height: 2px;
				background-color: #3b82f6;
				transition: width 0.3s ease;
			}

			.tab-link.active::after {
				width: 100%;
			}

			.tab-link:hover::after {
				width: 100%;
			}

			.animated-element {
				animation: fadeIn 0.5s ease-in-out;
			}

			@keyframes fadeIn {
				from {
					opacity: 0;
					transform: translateY(10px);
				}
				to {
					opacity: 1;
					transform: translateY(0);
				}
			}

			.hover-scale {
				transition: transform 0.3s ease;
			}

			.hover-scale:hover {
				transform: scale(1.05);
			}

			.image-container:hover .edit-icon {
				opacity: 1;
			}

			.edit-icon {
				opacity: 0;
				transition: opacity 0.3s ease;
			}
		</style>
	</head>
	<body class="bg-gray-50 text-gray-800 flex flex-col min-h-screen">
		<header class="bg-blue-600 p-4 shadow-md">
			<nav class="container mx-auto flex justify-between items-center">
				<div class="text-white font-bold text-xl">–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</div>
				<ul class="flex space-x-4">
					<li>
						<a
							href="{% url 'home' %}"
							class="text-white hover:bg-blue-700 px-3 py-2 rounded transition duration-300"
							>–ì–ª–∞–≤–Ω–∞—è</a
						>
            <li>
              <a href="{% url 'schedule' %}" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
            </a>
            </li>
					</li>
					{% if user.is_authenticated %}
					<li>
						<a
							href="{% url 'logout' %}"
							class="text-white hover:bg-blue-700 px-3 py-2 rounded transition duration-300"
							>–í—ã–π—Ç–∏</a
						>
					</li>
					{% else %}
					<li>
						<a
							href="{% url 'login' %}"
							class="text-white hover:bg-blue-700 px-3 py-2 rounded transition duration-300"
							>–í–æ–π—Ç–∏</a
						>
					</li>
					{% endif %}
				</ul>
			</nav>
		</header>

		<main class="container mx-auto p-6 flex-grow animated-element">
			{% block content %}{% endblock %}
		</main>

		<footer class="bg-blue-600 text-white text-center py-4 mt-auto">
			<div class="container mx-auto">
				<p>&copy; 2025 –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</p>
				<p class="text-sm mt-1">–í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã</p>
			</div>
		</footer>

		<script>
			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–∞–±–∞–º–∏
			function showTab(tabId) {
				// –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –ø–∞–Ω–µ–ª–∏ —Ç–∞–±–æ–≤
				document.querySelectorAll('.tab-pane').forEach(pane => {
					pane.classList.add('hidden')
				})

				// –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö —Å—Å—ã–ª–æ–∫
				document.querySelectorAll('.tab-link').forEach(link => {
					link.classList.remove(
						'active',
						'text-blue-600',
						'border-b-2',
						'border-blue-600'
					)
					link.classList.add('text-gray-600')
				})

				// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é –ø–∞–Ω–µ–ª—å
				const selectedPane = document.getElementById('tab-' + tabId)
				if (selectedPane) {
					selectedPane.classList.remove('hidden')
				}

				// –î–µ–ª–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—É—é —Å—Å—ã–ª–∫—É –∞–∫—Ç–∏–≤–Ω–æ–π
				const selectedLink = document.querySelector(
					`.tab-link[data-tab="${tabId}"]`
				)
				if (selectedLink) {
					selectedLink.classList.add(
						'active',
						'text-blue-600',
						'border-b-2',
						'border-blue-600'
					)
					selectedLink.classList.remove('text-gray-600')
				}
			}

			// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∏–∫–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø—Ä–µ–¥–º–µ—Ç–∞
			function initCharts() {
				document
					.querySelectorAll('canvas[id$="_attendanceChart"]')
					.forEach(canvas => {
						const subject = canvas.id.split('_')[0]
						const ctx = canvas.getContext('2d')

						// –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –æ –ø–æ—Å–µ—â–∞–µ–º–æ—Å—Ç–∏ –∏ –æ—Ü–µ–Ω–∫–∞—Ö –∏–∑ DOM
						// –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞—Ç—å —á–µ—Ä–µ–∑ data-–∞—Ç—Ä–∏–±—É—Ç—ã –∏–ª–∏ API
						const attendedCount = Math.floor(Math.random() * 20) + 10 // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö
						const missedCount = Math.floor(Math.random() * 10) // –ü—Ä–∏–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö

						new Chart(ctx, {
							type: 'doughnut',
							data: {
								labels: ['–ü–æ—Å–µ—â–µ–Ω–æ', '–ü—Ä–æ–ø—É—â–µ–Ω–æ'],
								datasets: [
									{
										label: '–ü–æ—Å–µ—â–∞–µ–º–æ—Å—Ç—å',
										data: [attendedCount, missedCount],
										backgroundColor: [
											'rgba(54, 162, 235, 0.7)',
											'rgba(255, 99, 132, 0.7)',
										],
										borderColor: [
											'rgba(54, 162, 235, 1)',
											'rgba(255, 99, 132, 1)',
										],
										borderWidth: 1,
									},
								],
							},
							options: {
								responsive: true,
								plugins: {
									legend: {
										position: 'top',
									},
									title: {
										display: true,
										text: `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –ø—Ä–µ–¥–º–µ—Ç—É "${subject}"`,
									},
									tooltip: {
										callbacks: {
											label: function (context) {
												const total = context.dataset.data.reduce(
													(a, b) => a + b,
													0
												)
												const value = context.raw
												const percentage =
													((value / total) * 100).toFixed(1) + '%'
												return `${context.label}: ${value} (${percentage})`
											},
										},
									},
								},
								animation: {
									animateScale: true,
									animateRotate: true,
								},
							},
						})
					})
			}

			// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
			document.addEventListener('DOMContentLoaded', function () {
				// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–æ–≤
				const tabLinks = document.querySelectorAll('.tab-link')

				tabLinks.forEach(link => {
					link.addEventListener('click', function (e) {
						e.preventDefault()
						const tabId = this.getAttribute('data-tab')
						showTab(tabId)
					})
				})

				// –ï—Å–ª–∏ –µ—Å—Ç—å —Ç–∞–±—ã, –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø–µ—Ä–≤—ã–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
				if (tabLinks.length > 0) {
					// –ü–µ—Ä–≤—ã–π —Ç–∞–± —É–∂–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω —á–µ—Ä–µ–∑ –∫–ª–∞—Å—Å—ã –≤ —à–∞–±–ª–æ–Ω–µ
					initCharts()
				}

				// –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
				const elementsToAnimate = document.querySelectorAll(
					'.child-statistics, .bg-white'
				)
				elementsToAnimate.forEach((el, index) => {
					el.style.animationDelay = `${index * 0.1}s`
					el.classList.add('animated-element')
				})

				// –ê–Ω–∏–º–∞—Ü–∏—è –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
				const userImage = document.getElementById('userImage')
				if (userImage) {
					userImage.addEventListener('mouseenter', function () {
						this.classList.add('ring-4', 'ring-blue-300')
					})

					userImage.addEventListener('mouseleave', function () {
						this.classList.remove('ring-4', 'ring-blue-300')
					})
				}
			})
		</script>
	</body>
</html>
